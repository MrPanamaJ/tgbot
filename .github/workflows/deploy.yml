name: Deploy Telegram Bot

on:
  workflow_dispatch:
  push:
    branches: [ main, master ]
  schedule:
    - cron: '0 */6 * * *'

jobs:
  deploy:
    runs-on: ubuntu-latest
    
    steps:
    - name: Checkout code
      uses: actions/checkout@v4
      
    - name: Set up Python
      uses: actions/setup-python@v4
      with:
        python-version: '3.10'
        
    - name: Install system dependencies
      run: |
        sudo apt-get update
        sudo apt-get install -y ffmpeg portaudio19-dev
        
    - name: Install Python dependencies
      run: |
        python -m pip install --upgrade pip
        if [ -f requirements.txt ]; then pip install -r requirements.txt; fi
        pip install pytelegrambotapi requests schedule qrcode[pil] pillow pydub speechrecognition beautifulsoup4 python-dotenv
        
    - name: Create temp directories
      run: |
        mkdir -p temp_voice_files temp_photo_files logs
        
    - name: Run Telegram Bot
      env:
        BOT_TOKEN: ${{ secrets.BOT_TOKEN }}
        WEATHER_API_URL: ${{ secrets.WEATHER_API_URL || 'https://api.open-meteo.com/v1/forecast' }}
        DATABASE_PATH: ${{ secrets.DATABASE_PATH || ':memory:' }}
        GITHUB_ACTIONS: 'true'
      run: |
        echo "üîß –ü—Ä–æ–≤–µ—Ä–∫–∞ –æ–∫—Ä—É–∂–µ–Ω–∏—è..."
        echo "BOT_TOKEN: ${BOT_TOKEN:0:10}..."
        echo "–ó–∞–ø—É—Å–∫ –±–æ—Ç–∞ –Ω–∞ GitHub Actions..."
        python main.py